-- 院系表
CREATE TABLE T_AMS_COLLEGE (
  ID   NUMBER(2) PRIMARY KEY,
  NAME VARCHAR2(20) UNIQUE NOT NULL
);
-- 用户表 （教师、学生）
CREATE TABLE T_AMS_USER (
  ID         NUMBER(6) PRIMARY KEY,
  NAME       VARCHAR2(20) NOT NULL UNIQUE,
  REAL_NAME  VARCHAR2(20) NOT NULL,
  PASSWORD   VARCHAR2(20) NOT NULL,
  ROLE       VARCHAR2(10) NOT NULL CHECK (ROLE IN ('student', 'teacher')),
  COLLEGE_ID NUMBER(2) REFERENCES T_AMS_COLLEGE (ID)
);

-- 课程表
CREATE TABLE T_AMS_SUBJECT (
  ID   NUMBER(2) PRIMARY KEY,
  NAME VARCHAR2(20) NOT NULL
);

-- 教师-课程表
CREATE TABLE T_AMS_TEACHER_SUBJECT (
  TID NUMBER(6) REFERENCES T_AMS_USER (ID),
  SID NUMBER(2) REFERENCES T_AMS_SUBJECT (ID),
  PRIMARY KEY (TID, SID)
);

-- 互动表
CREATE TABLE T_AMS_INTERACT (
  ID          NUMBER(10) PRIMARY KEY,
  TITLE       VARCHAR2(100) NOT NULL,
  DETAILS     VARCHAR2(500) NOT NULL,
  STATUS      VARCHAR2(4)   NOT NULL,
  CREATE_DATE DATE          NOT NULL,
  ANSWER      VARCHAR2(500),
  ANSWER_DATE DATE,
  SID         NUMBER(6) REFERENCES T_AMS_USER (ID), -- 学生 id
  TID         NUMBER(6) REFERENCES T_AMS_USER (ID)  -- 教师 id
);

DROP TABLE T_AMS_INTERACT;

CREATE SEQUENCE T_AMS_USER_SEQ START WITH 144010 INCREMENT BY 1;
CREATE SEQUENCE T_AMS_INTERACT_SEQ START WITH 1001001001 INCREMENT BY 1;


INSERT INTO T_AMS_COLLEGE VALUES (10, '软件学院');
INSERT INTO T_AMS_COLLEGE VALUES (20, '计算机学院');
INSERT INTO T_AMS_COLLEGE VALUES (30, '历史学院');

INSERT INTO T_AMS_SUBJECT VALUES (15, 'Core Java');
INSERT INTO T_AMS_SUBJECT VALUES (25, 'Java Web');
INSERT INTO T_AMS_SUBJECT VALUES (35, 'Oracle');
INSERT INTO T_AMS_SUBJECT VALUES (45, 'framework');

INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'qbj123', '乔保军', '123123', 'teacher', '20');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'zuofang', '左方', '123123', 'teacher', '10');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'yang123', '杨杨', '123123', 'teacher', '30');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'mingming', '渠慎明', '123123', 'teacher', '10');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'liang233', '梁胜斌', '123123', 'teacher', '30');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'huping', '胡萍', '123123', 'teacher', '20');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'dongdong', '冯东栋', '123123', 'teacher', '10');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'xiaoli', '李小丽', '123123', 'teacher', '10');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'baicxi', '白晨希', '123123', 'teacher', '20');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'xiaozhang', '娄源功', '123123', 'teacher', '40');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'zhengcg', '郑春光', '123123', 'teacher', '30');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'chenyn', '陈艳男', '123123', 'teacher', '10');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'yang867', '杨艳玲', '123123', 'teacher', '10');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'baizhi', '胡鑫喆', '123123', 'teacher', '20');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'dongdong123', '杨冬冬', '123123', 'teacher', '10');
INSERT INTO T_AMS_USER VALUES (T_AMS_USER_SEQ.nextval, 'chunyang', '刘春阳', '123123', 'teacher', '30');

INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144039, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144039, 25);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144039, 35);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144040, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144040, 45);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144041, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144041, 35);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144042, 25);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144043, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144043, 35);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144043, 45);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144044, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144045, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144045, 35);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144045, 25);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144046, 25);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144046, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144046, 35);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144048, 45);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144048, 25);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144051, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144051, 35);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144052, 25);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144052, 45);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144052, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144057, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144057, 45);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144057, 35);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144058, 25);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144060, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144060, 35);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144061, 45);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144061, 15);
INSERT INTO T_AMS_TEACHER_SUBJECT VALUES (144061, 25);

INSERT INTO T_AMS_INTERACT
VALUES (T_AMS_INTERACT_SEQ.nextval, '验证码同步问题', '在session中存入的验证码有延迟', '否', sysdate, NULL, NULL, 144031, 144042);
INSERT INTO T_AMS_INTERACT
VALUES (T_AMS_INTERACT_SEQ.nextval, '线程异步', '如何让两个线程交替执行', '否', sysdate, NULL, NULL, 144031, 144048);
INSERT INTO T_AMS_INTERACT
VALUES (T_AMS_INTERACT_SEQ.nextval, '今天天气不错', '然而没时间去爬山', '否', sysdate, NULL, NULL, 144031, 144057);
INSERT INTO T_AMS_INTERACT
VALUES (T_AMS_INTERACT_SEQ.nextval, '如何有效DeBug', 'DeBUG太慢，写代码效率低', '是', TO_DATE('2017-4-23', 'yyyy-MM-dd'),
        '多看报错信息，多分析，善于总结', sysdate, 144031, 144061);

SELECT *
FROM T_AMS_COLLEGE;
SELECT *
FROM T_AMS_USER;
SELECT *
FROM T_AMS_TEACHER_SUBJECT;
SELECT *
FROM T_AMS_INTERACT;

SELECT
  U.ID        userId,
  U.NAME      userName,
  U.REAL_NAME realName,
  U.PASSWORD  password,
  U.ROLE      role,
  C.ID        collegeId,
  C.NAME      collegeName,
  S.ID        subjectId,
  S.NAME      subjectName
FROM T_AMS_USER U LEFT JOIN T_AMS_COLLEGE C ON U.COLLEGE_ID = C.ID
  LEFT JOIN T_AMS_TEACHER_SUBJECT TS ON U.ID = TS.TID
  LEFT JOIN T_AMS_SUBJECT S ON TS.SID = S.ID;


SELECT
  ID,
  NAME
FROM T_AMS_TEACHER_SUBJECT T LEFT JOIN T_AMS_SUBJECT S ON T.SID = S.ID
WHERE T.TID = 144039;

SELECT *
FROM (SELECT
        ID,
        NAME,
        REAL_NAME  realName,
        PASSWORD,
        ROLE,
        COLLEGE_ID collegeId,
        ROWNUM     rn
      FROM T_AMS_USER
      WHERE REAL_NAME LIKE '%%' AND ROLE = 'teacher')
WHERE rn BETWEEN 3 AND 5;

SELECT
  S.ID,
  S.NAME
FROM T_AMS_TEACHER_SUBJECT T LEFT JOIN T_AMS_SUBJECT S ON T.SID = S.ID
WHERE T.TID = 144039;

SELECT COUNT(*)
FROM T_AMS_USER U LEFT JOIN T_AMS_COLLEGE C ON U.COLLEGE_ID = C.ID
WHERE ROLE = 'teacher' AND C.NAME LIKE '%软件%';

SELECT
  I.ID          interactId,
  I.TITLE       title,
  I.DETAILS     details,
  I.STATUS      status,
  I.CREATE_DATE creatDate,
  I.ANSWER      answer,
  I.ANSWER_DATE answerDate,
  I.SID         studentId,
  T.ID          teacherId,
  T.NAME        name,
  T.REAL_NAME   realName,
  T.PASSWORD    password,
  T.ROLE        role,
  C.ID          collegeId,
  C.NAME        collegeName
FROM T_AMS_INTERACT I LEFT JOIN T_AMS_USER T ON I.TID = T.ID
  LEFT JOIN T_AMS_COLLEGE C ON T.COLLEGE_ID = C.ID
